<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.sy.mapper.OrderMapper" >
  
  <insert id="insertOrder" parameterType="cn.sy.domain.Order" >
    insert into t_order (order_id, user_id, user_name)
    values (#{order_id,jdbcType=INTEGER}, #{user_id,jdbcType=INTEGER},#{user_name,jdbcType=VARCHAR})
  </insert>
  <insert id="insertOrderItem" parameterType="cn.sy.domain.OrderItem" useGeneratedKeys="true" keyProperty="id" >
    insert into t_order_item (item_id, order_id, user_id, item_name)
    values (#{item_id,jdbcType=INTEGER}, #{order_id,jdbcType=INTEGER}, #{user_id,jdbcType=INTEGER},#{item_name,jdbcType=VARCHAR})
  </insert>


	<select id="findAll" resultType="cn.sy.domain.Order">
		SELECT order_id, user_id, user_name
		FROM t_order
		ORDER BY order_id
	</select>
	
	<select id="findByUser" resultType="cn.sy.domain.Order">
		SELECT order_id, user_id, user_name
		FROM t_order
		WHERE user_id = #{user_id,jdbcType=INTEGER}
		ORDER BY order_id
	</select>
	
	<select id="findOrderWithItem" resultType="cn.sy.domain.OrderWithItem">
		SELECT o.order_id, o.user_id, o.user_name, oi.item_id, oi.item_name
		FROM t_order o
		JOIN t_order_item oi on o.order_id=oi.order_id
		ORDER BY o.order_id DESC
	</select>  <!--  and o.user_id=oi.user_id  -->
	
	<select id="findOrderWithPrice" resultType="map">
		SELECT o.order_id, o.user_id, o.user_name, oi.item_id, oi.item_name, p.price
		FROM t_order o
		JOIN t_order_item oi on o.order_id=oi.order_id
		LEFT JOIN t_product p on oi.item_name=p.name
		ORDER BY o.order_id DESC
	</select>  <!--  and o.user_id=oi.user_id  -->
	
</mapper>